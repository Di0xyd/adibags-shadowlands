--[[
AdiBags - Azerite Essence items
by Mandus
version: v1.0
Add various Azerite Essence items to AdiBags filter groups
]]

local addonName, addon = ...
local AdiBags = LibStub("AceAddon-3.0"):GetAddon("AdiBags")

local L = addon.L
local MatchIDs
local Tooltip
local Result = {}

local function AddToSet(Set, List)
	for _, v in ipairs(List) do
		Set[v] = true
	end
end

-- AnimaPower
local animaItems = {
181368,
181377,
181477,
181478,
181479,
181540,
181541,
181544,
181545,
181546,
181547,
181548,
181549,
181550,
181551,
181552,
181642,
181643,
181644,
181645,
181646,
181647,
181648,
181649,
181650,
181743,
181744,
181745,
183723,
183727,
184146,
184147,
184148,
184149,
184150,
184151,
184152,
184286,
184293,
184294,
184305,
184306,
184307,
184315,
184360,
184362,
184363,
184371,
184373,
184374,
184378,
184379,
184380,
184381,
184382,
184383,
184384,
184385,
184386,
184387,
184388,
184389,
184519,
184763,
184764,
184765,
184766,
184767,
184768,
184769,
184770,
184771,
184772,
184773,
184774,
184775,
184776,
184777
}

-- LegendaryUnlockItems
local legendaryItems = {
182617,
182625,
182626,
182627,
182628,
182629,
182630,
182631,
182632,
182633,
182634,
182635,
182636,
182637,
182638,
182640,
183210,
183211,
183212,
183213,
183214,
183215,
183216,
183217,
183218,
183219,
183220,
183221,
183222,
183223,
183224,
183225,
183226,
183227,
183228,
183229,
183230,
183231,
183232,
183233,
183234,
183235,
183236,
183237,
183238,
183239,
183240,
183241,
183242,
183243,
183244,
183245,
183246,
183247,
183248,
183249,
183250,
183251,
183252,
183253,
183254,
183255,
183256,
183257,
183258,
183259,
183260,
183261,
183262,
183263,
183264,
183265,
183266,
183267,
183268,
183269,
183270,
183271,
183272,
183273,
183274,
183275,
183276,
183277,
183278,
183279,
183280,
183281,
183282,
183283,
183284,
183285,
183286,
183287,
183288,
183289,
183290,
183291,
183292,
183293,
183294,
183295,
183296,
183297,
183298,
183299,
183300,
183301,
183302,
183303,
183304,
183305,
183306,
183307,
183308,
183309,
183310,
183311,
183312,
183313,
183314,
183315,
183316,
183317,
183318,
183319,
183320,
183321,
183322,
183323,
183324,
183325,
183326,
183327,
183328,
183329,
183330,
183331,
183332,
183333,
183334,
183335,
183336,
183337,
183338,
183339,
183340,
183341,
183342,
183343,
183344,
183345,
183346,
183347,
183348,
183349,
183350,
183351,
183352,
183353,
183354,
183355,
183356,
183357,
183358,
183359,
183360,
183361,
183362,
183363,
183364,
183365,
183366,
183367,
183368,
183369,
183370,
183371,
183372,
183373,
183374,
183375,
183376,
183377,
183378,
183379,
183380,
183381,
183382,
183383,
183384,
183385,
183386,
183387,
183388,
183389,
183390,
183391,
183392,
183393,
184665
}

-- Conduits
local conduitItems = { 
180842,
180843,
180844,
180847,
180896,
180932,
180933,
180935,
180943,
180944,
181373,
181376,
181383,
181389,
181435,
181455,
181461,
181462,
181464,
181465,
181466,
181467,
181469,
181495,
181498,
181504,
181505,
181506,
181508,
181509,
181510,
181511,
181512,
181539,
181553,
181600,
181624,
181639,
181640,
181641,
181698,
181700,
181705,
181707,
181709,
181712,
181734,
181735,
181736,
181737,
181738,
181740,
181742,
181756,
181759,
181769,
181770,
181774,
181775,
181776,
181786,
181826,
181827,
181834,
181836,
181837,
181838,
181840,
181841,
181842,
181843,
181844,
181845,
181847,
181848,
181866,
181867,
181942,
181943,
181944,
181962,
181963,
181974,
181975,
181980,
181981,
181982,
182105,
182106,
182107,
182108,
182109,
182110,
182111,
182113,
182125,
182126,
182127,
182128,
182129,
182130,
182131,
182132,
182133,
182134,
182135,
182136,
182137,
182138,
182139,
182140,
182141,
182142,
182143,
182144,
182145,
182187,
182201,
182203,
182206,
182208,
182288,
182292,
182295,
182304,
182307,
182316,
182317,
182318,
182321,
182324,
182325,
182330,
182331,
182335,
182336,
182338,
182339,
182340,
182344,
182345,
182346,
182347,
182348,
182368,
182383,
182384,
182385,
182440,
182441,
182442,
182448,
182449,
182456,
182460,
182461,
182462,
182463,
182464,
182465,
182466,
182468,
182469,
182470,
182471,
182476,
182478,
182480,
182559,
182582,
182584,
182598,
182604,
182605,
182608,
182610,
182621,
182622,
182624,
182646,
182648,
182649,
182651,
182656,
182657,
182667,
182675,
182677,
182681,
182684,
182685,
182686,
182706,
182736,
182743,
182747,
182748,
182750,
182751,
182752,
182753,
182754,
182755,
182767,
182769,
182770,
182772,
182777,
182778,
182960,
182961,
182962,
182964,
183044,
183076,
183132,
183167,
183184,
183197,
183199,
183202,
183396,
183402,
183463,
183464,
183465,
183466,
183467,
183468,
183469,
183470,
183471,
183472,
183473,
183474,
183476,
183477,
183478,
183479,
183480,
183481,
183482,
183483,
183484,
183485,
183486,
183487,
183488,
183489,
183490,
183491,
183492,
183493,
183494,
183495,
183496,
183497,
183498,
183499,
183500,
183501,
183502,
183503,
183504,
183505,
183506,
183507,
183508,
183509,
183510,
183511,
183512,
183513,
183514,
184359,
184587
}



local function MatchIDs_Init(self)
	wipe(Result)

	if self.db.profile.moveAnima then
		AddToSet(Result, animaItems)
	end

	if self.db.profile.moveConduits then
		AddToSet(Result, conduitItems)
	end
	
	if self.db.profile.moveLegendary then
		AddToSet(Result, legendaryItems)
	end

	return Result
end

local function Tooltip_Init()
	local tip, leftside = CreateFrame("GameTooltip"), {}
	for i = 1, 6 do
		local Left, Right = tip:CreateFontString(), tip:CreateFontString()
		Left:SetFontObject(GameFontNormal)
		Right:SetFontObject(GameFontNormal)
		tip:AddFontStrings(Left, Right)
		leftside[i] = Left
	end
	tip.leftside = leftside
	return tip
end

local setFilter = AdiBags:RegisterFilter("Shadowlands", 98, "ABEvent-1.0")
setFilter.uiName = "Shadowlands"
setFilter.uiDesc = "Shadowlands Stuff"

function setFilter:OnInitialize()
    self.db = AdiBags.db:RegisterNamespace("Shadowlands", {
        profile = {
            moveAnima = true,
            moveConduits = true,
			moveLegendary = true,
		}
	})
end

function setFilter:Update()
	MatchIDs = nil
	self:SendMessage("AdiBags_FiltersChanged")
end

function setFilter:OnEnable()
	AdiBags:UpdateFilters()
end

function setFilter:OnDisable()
	AdiBags:UpdateFilters()
end

function setFilter:Filter(slotData)
	MatchIDs = MatchIDs or MatchIDs_Init(self)
	if MatchIDs[slotData.itemId] then
		return "Shadowlands"
	end
	
	Tooltip = Tooltip or Tooltip_Init()
	Tooltip:SetOwner(UIParent,"ANCHOR_NONE")
	Tooltip:ClearLines()
	
	if slotData.bag == BANK_CONTAINER then
		Tooltip:SetInventoryItem("player", BankButtonIDToInvSlotID(slotData.slot, nil))
	else
		Tooltip:SetBagItem(slotData.bag, slotData.slot)
	end
	
	Tooltip:Hide()
end

function setFilter:GetOptions()
	return {
		moveAnima = {
			name = "Anima",
			desc = "Items which grant Anima",
			type = "toggle",
			order = 10
		},
		moveConduits = {
			name = "Conduits",
			desc = "Items used to unlock Conduits",
			type = "toggle",
			order = 20
		},
		moveLegendary = {
			name = "Legendary Power",
			desc = "Items used to unlock Legendary Powers",
			type = "toggle",
			order = 30
		},
	},
	AdiBags:GetOptionHandler(self, false, function ()
		return self:Update()
	end)
end
